{"content":"ZnJvbSBmdW5jdG9vbHMgaW1wb3J0IHJlZHVjZQpmcm9tIHR5cGluZyBpbXBvcnQgRGljdCwgTGlzdCwgT3B0aW9uYWwKCmltcG9ydCBweXNwYXJrLnNxbC5mdW5jdGlvbnMgYXMgZgpmcm9tIGRlbHRhLl90eXBpbmcgaW1wb3J0IENvbHVtbk1hcHBpbmcKZnJvbSBkZWx0YS50YWJsZXMgaW1wb3J0IERlbHRhVGFibGUKZnJvbSBweWRhbnRpYyBpbXBvcnQgQmFzZU1vZGVsCmZyb20gcHlzcGFyay5lcnJvcnMuZXhjZXB0aW9ucy5iYXNlIGltcG9ydCBBbmFseXNpc0V4Y2VwdGlvbgpmcm9tIHB5c3Bhcmsuc3FsIGltcG9ydCBEYXRhRnJhbWUKZnJvbSBweXNwYXJrLnNxbC53aW5kb3cgaW1wb3J0IFdpbmRvdwoKZnJvbSAuLmVudW1zIGltcG9ydCBUYWJsZUZvcm1hdApmcm9tIC4udXRpbCBpbXBvcnQgbWF0Y2hlc19hbnlfcGF0dGVybgpmcm9tIC5jb3JlIGltcG9ydCBCYXNlQ29uc3VtZXIsIGNvbnN1bWVyCgoKY2xhc3MgTWV0YUNvbHVtbnNQcm9jZXNzb3IoQmFzZU1vZGVsKToKICAgIGlkX2NvbDogc3RyID0gJ19pZCcKICAgIGZvb3RwcmludF9jb2w6IHN0ciA9ICdfZm9vdHByaW50JwoKICAgIGRlZiBnZXRfbWV0YV9jb2xfbGlzdChzZWxmKSAtPiBMaXN0W3N0cl06CiAgICAgICAgcmV0dXJuIFtzZWxmLmlkX2NvbCwgc2VsZi5mb290cHJpbnRfY29sXQoKICAgIGRlZiBhcHBseShzZWxmLCBkZjogRGF0YUZyYW1lKSAtPiBEYXRhRnJhbWU6CiAgICAgICAgbG93ZXJfY29scyA9IFtjLmxvd2VyKCkgZm9yIGMgaW4gZGYuY29sdW1uc10KICAgICAgICByZXR1cm4gKAogICAgICAgICAgICBkZgogICAgICAgICAgICAud2l0aENvbHVtbihzZWxmLmZvb3RwcmludF9jb2wsIGYuc3RydWN0KAogICAgICAgICAgICAgICAoZi5jb2woc2VsZi5pZF9jb2wpIGlmIHNlbGYuaWRfY29sIGluIGxvd2VyX2NvbHMgZWxzZSBmLmxpdChOb25lKS5jYXN0KCdzdHJpbmcnKSkuYWxpYXMoJ3Vwc3RyZWFtX2lkJyksCiAgICAgICAgICAgICAgICBmLmN1cnJlbnRfdGltZXN0YW1wKCkuYWxpYXMoJ2NyZWF0ZV90cycpLAogICAgICAgICAgICAgICAgZi5jdXJyZW50X3RpbWVzdGFtcCgpLmFsaWFzKCdtb2RpZnlfdHMnKQogICAgICAgICAgICApKQogICAgICAgICAgICAuc2VsZWN0KAogICAgICAgICAgICAgICAgZi5leHByKCd1dWlkKCknKS5hbGlhcyhzZWxmLmlkX2NvbCksCiAgICAgICAgICAgICAgICAqW2MgZm9yIGMgaW4gbG93ZXJfY29scyBpZiBjIG5vdCBpbiAoc2VsZi5pZF9jb2wsIHNlbGYuZm9vdHByaW50X2NvbCldLAogICAgICAgICAgICAgICAgZi5jb2woc2VsZi5mb290cHJpbnRfY29sKQogICAgICAgICAgICApCiAgICAgICAgKQoKCkBjb25zdW1lcgpjbGFzcyBTYXZlQXNUYWJsZShCYXNlQ29uc3VtZXIpOgogICAgdGFibGU6IHN0cgogICAgZm9ybWF0OiBUYWJsZUZvcm1hdCA9IFRhYmxlRm9ybWF0LkRFTFRBCiAgICBwYXJ0aXRpb25fYnk6IE9wdGlvbmFsW0xpc3Rbc3RyXV0gPSBOb25lCiAgICBvcHRpb25zOiBPcHRpb25hbFtEaWN0W3N0ciwgc3RyXV0gPSBOb25lCgogICAgZGVmIGNvbnN1bWUoc2VsZiwgZGY6IERhdGFGcmFtZSwgXzogT3B0aW9uYWxbaW50XSA9IE5vbmUpIC0+IE5vbmU6CiAgICAgICAgbWV0YSA9IE1ldGFDb2x1bW5zUHJvY2Vzc29yKCkKICAgICAgICB3cml0ZXIgPSBtZXRhLmFwcGx5KGRmKS53cml0ZS5mb3JtYXQoc2VsZi5mb3JtYXQudmFsdWUpCiAgICAgICAgaWYgc2VsZi5wYXJ0aXRpb25fYnk6CiAgICAgICAgICAgIHdyaXRlci5wYXJ0aXRpb25CeShzZWxmLnBhcnRpdGlvbl9ieSkKICAgICAgICBpZiBzZWxmLm9wdGlvbnM6CiAgICAgICAgICAgIHdyaXRlci5vcHRpb25zKCoqc2VsZi5vcHRpb25zKQogICAgICAgIHdyaXRlci5zYXZlQXNUYWJsZShzZWxmLnRhYmxlKQoKCkBjb25zdW1lcgpjbGFzcyBNZXJnZVRhYmxlKEJhc2VDb25zdW1lcik6CiAgICB0YWJsZTogc3RyCiAgICBrZXlfY29sdW1uczogT3B0aW9uYWxbTGlzdFtzdHJdXSA9IE5vbmUKICAgIGlnbm9yZV9jb2x1bW5zOiBPcHRpb25hbFtMaXN0W3N0cl1dID0gTm9uZQogICAgZHJvcF9jb2x1bW5zOiBPcHRpb25hbFtMaXN0W3N0cl1dID0gTm9uZQogICAgZGVsZXRlX2NvbmRpdGlvbjogc3RyID0gJ0ZhbHNlJwogICAgZGVsZXRlX3doZW5fbm90X21hdGNoZWRfYnlfc291cmNlOiBib29sID0gRmFsc2UKICAgIGV2ZW50X29yZGVyX2V4cHJlc3Npb25fbGlzdDogT3B0aW9uYWxbTGlzdFtzdHJdXSA9IE5vbmUKICAgIGV2ZW50X29yZGVyX2lzX2Fic29sdXRlOiBib29sID0gRmFsc2UKICAgIGNvbHVtbnNfaWdub3JlX2Nhc2U6IGJvb2wgPSBUcnVlCiAgICBwYXJ0aXRpb25fYnk6IE9wdGlvbmFsW0xpc3Rbc3RyXV0gPSBOb25lCgogICAgZGVmIGNvbnN1bWUoc2VsZiwgZGY6IERhdGFGcmFtZSwgXzogT3B0aW9uYWxbaW50XSA9IE5vbmUpIC0+IE5vbmU6CiAgICAgICAgbWV0YSA9IE1ldGFDb2x1bW5zUHJvY2Vzc29yKCkKICAgICAgICBkZiA9IG1ldGEuYXBwbHkoZGYpCiAgICAgICAgcmVzb2x2ZWRfaWdub3JlX2NvbHVtbnMgPSBbCiAgICAgICAgICAgIGMgZm9yIGMgaW4gZGYuY29sdW1ucwogICAgICAgICAgICBpZiBtYXRjaGVzX2FueV9wYXR0ZXJuKGMsIHNlbGYuaWdub3JlX2NvbHVtbnMgb3IgWydfLio/J10sIHNlbGYuY29sdW1uc19pZ25vcmVfY2FzZSkKICAgICAgICBdICsgbWV0YS5nZXRfbWV0YV9jb2xfbGlzdCgpCgogICAgICAgIHJlc29sdmVkX2tleV9jb2x1bW5zID0gKAogICAgICAgICAgICBbYyBmb3IgYyBpbiBkZi5jb2x1bW5zIGlmIG5vdCBtYXRjaGVzX2FueV9wYXR0ZXJuKGMsIHJlc29sdmVkX2lnbm9yZV9jb2x1bW5zLCBzZWxmLmNvbHVtbnNfaWdub3JlX2Nhc2UpXQogICAgICAgICAgICBpZiBub3Qgc2VsZi5rZXlfY29sdW1ucwogICAgICAgICAgICBlbHNlIFtjIGZvciBjIGluIGRmLmNvbHVtbnMgaWYgbWF0Y2hlc19hbnlfcGF0dGVybihjLCBzZWxmLmtleV9jb2x1bW5zLCBzZWxmLmNvbHVtbnNfaWdub3JlX2Nhc2UpXQogICAgICAgICkKCiAgICAgICAgIyBCZWNhdXNlIHRoZSB3cml0ZSBzdHJhdGVneSBpcyBNRVJHRSwgd2Ugb2Z0ZW4gbmVlZCB0byBlbnN1cmUgb25seSBhIHNpbmdsZSByZWNvcmQgZXhpc3RzIGluIHRoZSB0YWJsZSBwZXIga2V5LgogICAgICAgICMgSWYgYGV2ZW50X29yZGVyXypgIGZpZWxkcyBhcmUgcHJvdmlkZWQsIHBlcmZvcm0gZXh0cmEgcHJvY2Vzc2luZyB0byBlbGltaW5hdGUgIm9sZGVyIiB2ZXJzaW9ucyBvZiByZWNvcmRzCiAgICAgICAgIyB3aGVuIG11bHRpcGxlIHJlY29yZHMgKGV2ZW50cykgZXhpc3QgcGVyIGtleS4KICAgICAgICBpZiBzZWxmLmV2ZW50X29yZGVyX2V4cHJlc3Npb25fbGlzdDoKICAgICAgICAgICAgY29udmVydGVkID0gW10KICAgICAgICAgICAgZm9yIGV4IGluIHNlbGYuZXZlbnRfb3JkZXJfZXhwcmVzc2lvbl9saXN0OgogICAgICAgICAgICAgICAgcGFydHMgPSBleC5zcGxpdCgnICcpCiAgICAgICAgICAgICAgICBpZiBsZW4ocGFydHMpID09IDEgb3IgcGFydHNbLTFdLmxvd2VyKCkgPT0gJ2FzYyc6CiAgICAgICAgICAgICAgICAgICAgY29udmVydGVkLmFwcGVuZChmLmFzYyhwYXJ0c1swXSkpCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIGNvbnZlcnRlZC5hcHBlbmQoZi5kZXNjKHBhcnRzWzBdKSkKICAgICAgICAgICAgZGYgPSAoCiAgICAgICAgICAgICAgICBkZi53aXRoQ29sdW1uKCdfcmVjZW5jeScsIGYucm93X251bWJlcigpLm92ZXIoCiAgICAgICAgICAgICAgICAgICAgV2luZG93LnBhcnRpdGlvbkJ5KHJlc29sdmVkX2tleV9jb2x1bW5zKQogICAgICAgICAgICAgICAgICAgIC5vcmRlckJ5KGNvbnZlcnRlZCkKICAgICAgICAgICAgICAgICkpCiAgICAgICAgICAgICAgICAuZmlsdGVyKGYuY29sKCdfcmVjZW5jeScpID09IDEpCiAgICAgICAgICAgICAgICAuZHJvcCgnX3JlY2VuY3knKQogICAgICAgICAgICApCgogICAgICAgIHRyeToKICAgICAgICAgICAgZHQgPSBEZWx0YVRhYmxlLmZvck5hbWUoZGYuc3BhcmtTZXNzaW9uLCBzZWxmLnRhYmxlKQogICAgICAgIGV4Y2VwdCBBbmFseXNpc0V4Y2VwdGlvbjoKICAgICAgICAgICAgZGYud3JpdGUuc2F2ZUFzVGFibGUoc2VsZi50YWJsZSkKICAgICAgICAgICAgcmV0dXJuCgogICAgICAgIG1hdGNoX2NvbmRpdGlvbiA9IHJlZHVjZSgKICAgICAgICAgICAgbGFtYmRhIGEsIGI6IGEgJiBiLAogICAgICAgICAgICBbCiAgICAgICAgICAgICAgICBmLmNvbChmJ2luYy57Y30nKS5lcU51bGxTYWZlKGYuY29sKGYndGFiLntjfScpKQogICAgICAgICAgICAgICAgZm9yIGMgaW4gcmVzb2x2ZWRfa2V5X2NvbHVtbnMKICAgICAgICAgICAgXQogICAgICAgICkKICAgICAgICBtZXJnZSA9IGR0LmFsaWFzKCd0YWInKS5tZXJnZShkZi5hbGlhcygnaW5jJyksIG1hdGNoX2NvbmRpdGlvbikKCiAgICAgICAgIyBEZWxldGVzCiAgICAgICAgbWVyZ2UgPSBtZXJnZS53aGVuTWF0Y2hlZERlbGV0ZShmLmV4cHIoc2VsZi5kZWxldGVfY29uZGl0aW9uKSkKCiAgICAgICAgIyBVcGRhdGVzCiAgICAgICAgaWYgc2VsZi5rZXlfY29sdW1uczoKICAgICAgICAgICAgdXBkYXRlX2NvbmRpdGlvbiA9IHJlZHVjZSgKICAgICAgICAgICAgICAgIGxhbWJkYSBhLCBiOiBhIHwgYiwKICAgICAgICAgICAgICAgIFsKICAgICAgICAgICAgICAgICAgICB+Zi5jb2woZidpbmMue2N9JykuZXFOdWxsU2FmZShmLmNvbChmJ3RhYi57Y30nKSkKICAgICAgICAgICAgICAgICAgICBmb3IgYyBpbiBkZi5jb2x1bW5zCiAgICAgICAgICAgICAgICAgICAgaWYgbm90IG1hdGNoZXNfYW55X3BhdHRlcm4oYywgcmVzb2x2ZWRfa2V5X2NvbHVtbnMgKyByZXNvbHZlZF9pZ25vcmVfY29sdW1ucywgc2VsZi5jb2x1bW5zX2lnbm9yZV9jYXNlKQogICAgICAgICAgICAgICAgXQogICAgICAgICAgICApCiAgICAgICAgICAgIHVwZGF0ZV9zZXRfZXhwcjogQ29sdW1uTWFwcGluZyA9IHsKICAgICAgICAgICAgICAgIGM6IGYuY29sKGYnaW5jLntjfScpCiAgICAgICAgICAgICAgICBmb3IgYyBpbiByZXNvbHZlZF9rZXlfY29sdW1ucwogICAgICAgICAgICB9CiAgICAgICAgICAgIG1lcmdlID0gbWVyZ2Uud2hlbk1hdGNoZWRVcGRhdGUoc2V0PXVwZGF0ZV9zZXRfZXhwciwgY29uZGl0aW9uPXVwZGF0ZV9jb25kaXRpb24pCiAgICAgICAgbWVyZ2UgPSBtZXJnZS53aGVuTWF0Y2hlZFVwZGF0ZShzZXQ9e30pICAjIERvIG5vdGhpbmcgd2l0aCBtYXRjaGVkIHJlY29yZHMgdGhhdCBoYXZlIG5vIGNoYW5nZXMKCiAgICAgICAgIyBJbnNlcnRzCiAgICAgICAgaW5zZXJ0X3NldF9leHByOiBDb2x1bW5NYXBwaW5nID0gewogICAgICAgICAgICBjOiBmLmNvbChmJ2luYy57Y30nKQogICAgICAgICAgICBmb3IgYyBpbiBkZi5jb2x1bW5zCiAgICAgICAgICAgIGlmIG5vdCBtYXRjaGVzX2FueV9wYXR0ZXJuKGMsIHNlbGYuZHJvcF9jb2x1bW5zIG9yIFtdLCBzZWxmLmNvbHVtbnNfaWdub3JlX2Nhc2UpCiAgICAgICAgfQogICAgICAgIG1lcmdlID0gbWVyZ2Uud2hlbk5vdE1hdGNoZWRJbnNlcnQodmFsdWVzPWluc2VydF9zZXRfZXhwciwgY29uZGl0aW9uPX5mLmV4cHIoc2VsZi5kZWxldGVfY29uZGl0aW9uKSkKCiAgICAgICAgIyBJbiB0aGUgZXZlbnQgd2UgaGF2ZSBhIGZ1bGwtc25hcHNob3QgaW5wdXQgYW5kIHdlIHNob3VsZCBkZWxldGUgbWlzc2luZyBrZXlzLi4KICAgICAgICBpZiBzZWxmLmRlbGV0ZV93aGVuX25vdF9tYXRjaGVkX2J5X3NvdXJjZToKICAgICAgICAgICAgbWVyZ2Uud2hlbk5vdE1hdGNoZWRCeVNvdXJjZURlbGV0ZSgpCgogICAgICAgIG1lcmdlLmV4ZWN1dGUoKQo=","file_type":""}